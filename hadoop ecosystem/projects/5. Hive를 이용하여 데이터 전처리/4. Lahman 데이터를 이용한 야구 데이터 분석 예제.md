---
style: |
  img {
    display: block;
    float: none;
    margin-left: auto;
    margin-right: auto;
  }
marp: true
paginate: true
---
# [Lahman 데이터를 이용한 야구 데이터 분석 예제](https://github.com/frrmack/hadoop-python-hive-tutorial/blob/master/hive.md) 
### 단계1: (Github) Master.csv > (ubuntu) Master.csv 
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image.png)

---
### 단계2: 데이터 확인 
```shell
# 파일 확인 
ls 
# 데이터 확인(컬럼명 + 데이터) 
head Master.csv 
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-1.png)

---
- 컬럼명 확인 
```shell
head -n 1 Master.csv | tr ',' '\n'
```
![bg right w:600](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-2.png)

---
- (컬럼명을 제외한)상위 10개 데이터 조회 
```shell
tail -n +2 Master.csv | head
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-3.png)

---
### 단계3: baseballdata/Master.csv
- 컬럼을 제외한 데이터 파일 생성 
```shell
mkdir baseballdata
tail -n +2 Master.csv > tmp && mv tmp baseballdata/Master.csv
ls -al baseballdata
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-4.png)

---
### 단계4: hadoop 데이터 전달 
```shell
# hadoop 디렉토리 확인 
hdfs dfs -ls /
# hadoop 디렉토리 생성
hdfs dfs -mkdir -p /hive/baseballdata
# hadoop 데이터 전달
hdfs dfs -put baseballdata/Master.csv /hive/baseballdata
# hadoop 데이터 확인 
hdfs dfs -ls /hive/baseballdata
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-5.png)

---
### 단계5: Hive > Master 테이블 생성 
```shell
# hive 접속 
hive
# 데이터베이스 생성
create database baseballdata;
use baseballdata;
```
![w:900](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-6.png)

---
- Master 테이블 생성
```sql
CREATE TABLE IF NOT EXISTS Master
(lahmanID INT,
playerID STRING,
managerID STRING,
hofID STRING,
birthYear INT,
birthMonth INT,
birthDay INT,
birthCountry STRING,
birthState STRING,
birthCity STRING,
deathYear INT,
deathMonth INT,
deathDay INT,
deathCountry STRING,
deathState STRING,
deathCity STRING,
nameFirst STRING,
nameLast STRING,
nameNote STRING,
nameGiven STRING,
nameNick STRING,
weight INT,
height INT,
bats STRING,
throws STRING,
debut STRING,
finalGame STRING,
college STRING,
lahman40ID STRING,
lahman45ID STRING,
retroID STRING,
holtzID STRING,
bbrefID STRING)
COMMENT 'Master Player Table'
ROW FORMAT DELIMITED
FIELDS TERMINATED BY ','
STORED AS TEXTFILE;
```
![bg right w:500](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-7.png)

---
### 단계6: Hive > Upload data
```shell
LOAD DATA INPATH '/hive/baseballdata/Master.csv' OVERWRITE INTO TABLE Master;
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-8.png)

---
### 단계7: Hive > 데이터 조회 
```sql
select * from Master limit 5;
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-9.png)

---
```sql
SELECT COUNT(playerid) FROM Master;
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-10.png)

---
```sql
SELECT weight, count(playerID) FROM Master GROUP BY weight;
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-11.png)

---
### 단계8: Join example in Hive
- Salaries.csv 파일 추가 
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-12.png)

---
- 컬럼명 확인 
```shell
head -n 1 Salaries.csv | tr ',' '\n'
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-13.png)

---
- hadoop에 Salaries.csv 파일 추가
```shell
# 컬럼데이터를 제외한 파일 생성 
tail -n +2 Salaries.csv > tmp && mv tmp baseballdata/Salaries.csv
# 파일 확인 
ls -al baseballdata
# hadoop 데이터 전달
hdfs dfs -put baseballdata/Salaries.csv /hive/baseballdata
# hadoop 데이터 확인 
hdfs dfs -ls /hive/baseballdata
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-14.png)

---
- hive 접속 
```shell
hive
```
- 테이블 생성 
```sql
-- 데이터베이스 적용 
use baseballdata;

-- 테이블 생성
CREATE TABLE IF NOT EXISTS Salaries
(yearID INT, teamID STRING, lgID STRING, playerID STRING, salary INT)              
COMMENT 'Salary Table for Players'                                                 
ROW FORMAT DELIMITED                                                               
FIELDS TERMINATED BY ','                                                           
STORED AS TEXTFILE; 

-- 테이블 리스트 조회 
show tables;
```
![bg right w:600](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-15.png)

---
- 데이터 삽입
```sql
LOAD DATA INPATH '/hive/baseballdata/Salaries.csv' OVERWRITE INTO TABLE Salaries;
select * from Salaries limit 5;
```
![Alt text](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-16.png)

---
- Join
```sql
SELECT 
  Salaries.yearID, Master.nameFirst, Master.nameLast, Master.weight, Salaries.salary
FROM Master JOIN Salaries 
  ON (Master.playerID = Salaries.playerID) 
WHERE Master.weight > 270;
```
![w:700](./img/4.%20Lahman%20데이터를%20이용한%20야구%20데이터%20분석%20예제/image-17.png)

